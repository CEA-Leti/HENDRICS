# Path Exploitation for Privilege Escalation

## Attack Overview
In this scenario, you are an attacker with low-privileged access to a target system. The goal of this attack is to escalate privileges by exploiting a PATH manipulation vulnerability in a binary with the SUID (Set User ID) bit enabled, ultimately gaining a root shell.

The SUID bit allows any user to execute a binary with the permissions of its owner. In this scenario, the vulnerable binary calls the `vi` command. By manipulating the systemâ€™s PATH environment variable, we can trick the binary into executing a malicious program of our choice under root privileges.

To carry out the attack, we proceed as follows:  
1. **Inject a Malicious Binary:** First, we craft a custom binary that spawns a root shell and name it `vi`. This binary is then placed on the target system.  
2. **Modify the PATH Variable:** We modify the PATH environment variable so that the vulnerable binary calls our malicious `vi` binary instead of the legitimate one.
3. **Execute the Vulnerable Binary:** We execute the vulnerable binary, which then calls our malicious vi binary, granting us a shell with root privileges.

## Requirements
Before running the attack, you MUST have the testbed installed.
See the [installation guide](../../embedded-device/README.md) to install the testbed.

The following Linux packages are required for the attack:  
    - `openssh-client`  
    - `sshpass`  

To install these packages, run the following command:
```bash
sudo apt install openssh-client sshpass
```

## Attack Execution
To execute the attack, run the following command:  
```bash
./exploit.sh 
```

If you prefer, to execute the attack in non-interactive mode, specify the target's IP address and credentials:  
```bash
./exploit.sh -all <Target IP Address> -p <Low-Privileged Username> <Low-Privileged Password>
```

Alternatively, you can use SSH keys instead of a password:  
```bash
./exploit.sh -all <Target IP Address> -k <Low-Privileged Username> <Path to SSH Key File>
```

## System Restoration
To restore the system to its state prior to the attack, execute the following command:  
```bash
./restoration.sh <Target IP Address> <Low-Privileged Username>
```
> [!NOTE]
> The username must be the same as the one used during the attack.

## MITRE ATT&CK Techniques List
The following table lists the MITRE ATT&CK for ICS techniques used in this attack:  

| Technique ID | Technique Name           | Justification                            |
|--------------|--------------------------|------------------------------------------|
| T0807        | Command-Line Interface                |The target system's command-line interface is used to perform the path exploitation. |
| T0853        | Scripting                             |Bash commands are used to perform the path exploitation.                             |  
| T0890        | Exploitation for Privilege Escalation |The goal of this attack is to gain root access.                                      |

> [!NOTE]
> This table is based on [MITRE ATT&CK for ICS v17](https://attack.mitre.org/versions/v17/matrices/ics/).

